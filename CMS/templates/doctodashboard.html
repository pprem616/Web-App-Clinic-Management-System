{% load static %}

<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">


    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700;800;900&display=swap" rel="stylesheet">
    <title>Doctor | Dashboard</title>

    <link rel="stylesheet" type="text/css" href="{% static 'css/dashboard.css' %}">
	<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700;800&family=Roboto:wght@300;400;500;700;900&display=swap" rel="stylesheet">
	<!--fontawesome-->
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css"
        integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="{%static 'js/med-index.js'%}"></script>
    

    <script type="text/javascript">
        $(document).ready(function () {
        
        window.setTimeout(function() {
            $(".msg").fadeTo(300, 0).slideUp(300, function(){
                $(this).remove(); 
            });
        }, 2000);
        
        });
       
    </script>
    <style>
    #snackbar {
      visibility: hidden;
      min-width: 250px;
      margin-left: -125px;
      background-color: #333;
      color: #fff;
      text-align: center;
      border-radius: 2px;
      padding: 16px;
      position: fixed;
      z-index: 1;
      left: 50%;
      bottom: 30px;
      font-size: 17px;
    }
    
    #snackbar.show {
      visibility: visible;
      -webkit-animation: fadein 0.5s, fadeout 0.5s 2.5s;
      animation: fadein 0.5s, fadeout 0.5s 2.5s;
    }
    
    @-webkit-keyframes fadein {
      from {bottom: 0; opacity: 0;} 
      to {bottom: 30px; opacity: 1;}
    }
    
    @keyframes fadein {
      from {bottom: 0; opacity: 0;}
      to {bottom: 30px; opacity: 1;}
    }
    
    @-webkit-keyframes fadeout {
      from {bottom: 30px; opacity: 1;} 
      to {bottom: 0; opacity: 0;}
    }
    
    @keyframes fadeout {
      from {bottom: 30px; opacity: 1;}
      to {bottom: 0; opacity: 0;}
    }

    </style>

  </head>



  <body>


    <div id="wrapper">
        <!-- Sidebar -->
        <nav class="fixed-top align-top bg-dark toggled" id="sidebar-wrapper" role="navigation">
        <div class="simplebar-content" style="padding: 0px;">
                <a class="sidebar-brand" >
                    <span class="text-center text-white"><h4>C M S</h4></span>
                </a>

                <ul class="navbar-nav nav nav-tabs align-self-stretch">

                <li class="sidebar-header text-center">  NAVIGATION </li>
                <li>
                    <a class="nav-link text-left active" data-toggle = "tab" href="#dashboard">
                        <i class="fas fa-tachometer-alt" style="color:white" ></i>  Dashboard
                    </a>
                </li>
                <li>
                    <a class="nav-link text-left" data-toggle = "tab" href="#profile">
                        <i class="fas fa-smile" style="color:white" ></i>   Profile
                    </a>
                </li>

                <li>
                    <a class="nav-link text-left"  data-toggle = "tab" href="#VPG">
                        <i class="fas fa-microphone" style="color:white" ></i> Voice Prescription Generator
                    </a>
                </li>
            
                <li>
                    <a class="nav-link text-left"  data-toggle = "tab" href="#appointment">
                        <i class="fas fa-book-medical" style="color:white" ></i>  Appointment 
                    </a>
                </li>
		    </ul>
            </div>
        </nav>
        <!-- /#sidebar-wrapper -->
        <!-- Page Content -->
        <div id="page-content-wrapper">
            <div id="content">
                <div class="container-fluid p-0 px-lg-0 px-md-0">
        <!-- Topbar -->
                    <nav class="navbar navbar-expand navbar-light my-navbar">
        <!-- Sidebar Toggle (Topbar) -->
                        
                        <!-- Topbar Search -->
                        <!-- Topbar Navbar -->
                        <ul class="navbar-nav ml-auto list-inline">
                    <!-- Nav Item - Search Dropdown (Visible Only XS) -->
                    <!-- Nav Item - Alerts -->
                    <!-- Nav Item - Messages -->
                    <!-- Nav Item - User Information -->
                            <li class="list-inline-item text-right">
                                <li class="list-inline-item text-right">
                                    <i class="fas fa-user-md fa-2x mt-3 pt-2 mr-1" style="color:#38ACEC;"></i>  
                                </li>
                                <span class="mt-1 pt-4 pr-3"> {% for i in userinfo %} Dr. {{i.first_name}} {{i.last_name}}{% endfor %}</span>
                            </li>
                                 <a href="../" class="mt-3 mb-3 mr-3 pt-1 pb-1"> <button class="btn btn-danger" style="color:white;"><i class="fas fa-power-off pt-1 pb-1"></i> </button> </a>
                        </ul>
                    </nav>


                     {% for message in messages %}
                    <div class="alert alert-{{message.tags}} alert-dismissible fade show msg" role="alert">
                    <strong class="text-center">
                        <h6>{{message}}</h6>
                    </strong>
                    </div>
                {% endfor %}
                


                <div class="tab-content">
                  
                    <div id="dashboard" class="tab-pane active">
                        <div class="container-fluid px-lg-4">
                            <div class="row">
                                <div class="col-md-12 mt-lg-4 mt-4">
                                    <div class="d-sm-flex align-items-center justify-content-between mb-4">
                                        <h1 class="h3 mb-0 text-gray-800"> Dashboard</h1>
                                    </div>
                                </div>
                            </div>
                        </div>

                         <div class="form-row ml-4">
                           
                            <div class="col-md-3 m-2 p-4 dashbox ">
                                <div class="mt-3 mb-3 text-center">
                                    <div class="panel-body">
                                        <span class="fa-stack fa-2x">
                                            <i class="fas fa-smile" style="font-size:45px;color:#007bff"></i>
                                        </span>
                                        <h5 class="m-3 dashhead">My Profile</h5>
                                    </div>
                                </div>
                            </div>
                        
                            <div class="col-md-3 m-2 p-4 dashbox">
                                <div class="mt-3 mb-3 s text-center">
                                    <div class="panel-body">
                                        <span class="fa-stack fa-2x">
                                            <i class="fas fa-microphone" style="font-size:45px;color:#007bff"></i>
                                        </span>
                                        <h5 class="m-3 dashhead">Voice Prescription Generator</h5>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3 m-2 p-4 dashbox">
                                <div class="mt-3 mb-3  text-center">
                                    <div class="panel-body">
                                        <span class="fa-stack fa-2x">
                                        <i class="fas fa-book-medical" style="font-size:45px;color:#007bff"90></i>
                                        </span>
                                        <h5 class="m-3 dashhead">Appointment</h5>
                                    </div>
                                </div>
                            </div>

                        </div>


                    </div>


                    <div id="profile" class="tab-pane fade in">
                        <div class="container-fluid px-lg-4">
                            <div class="row">
                                <div class="col-md-12 mt-lg-4 mt-4">
                                    <div class="d-sm-flex align-items-center justify-content-between mb-4">
                                        <h1 class="h3 mb-0 text-gray-800"> My Profile</h1>
                                    </div>
                                </div>
                            </div>
                        </div>
                                <div class="ml-5" style="width:60%;">
                               
                            
                                    <div class="alert alert-warning alert-dismissible fade show" role="alert">
                                        <h6> You can update your Profile ! </h6> 
                                    </div>
                                

                             <form method="POST" action={% url 'updateprofiledoctor' %} >
                            {% csrf_token %}
                            {% for i in userinfo %}

                                <div class="form-row m-3 ">
                                    <div class="col-md-4 mt-3">
                                        <div class="formlabel text-left">First Name :</div>
                                        <input type="text" class="form-control" id="pdirstName" name="first_name" placeholder="First Name" value= {{ i.first_name}}  required="true">
                                    </div>

                                    <div class="col-md-4 mt-3">
                                        <div class="formlabel text-left">Middle Name :</div>
                                        <input type="text" class="form-control" id="dMiddleName" name="middle_name" placeholder="Middle Name" value= {{ i.middle_name}} required="true">
                                    </div>
                                    
                                    <div class="col-md-4 mt-3">
                                        <div class="formlabel text-left">Last Name :</div>
                                        <input type="text" class="form-control" id="dLastName" name="last_name" placeholder="Last Name" value= {{ i.last_name}} required="true">
                                    </div>
                                </div>

                                <div class="form-row m-3">
                                    
                                    <div class="col-md-3">
                                        <div class="formlabel text-left">DOB :</div>
                                        <input type="text" class="form-control" id="dDOB" name="d_o_b" placeholder="dd/mm/yyyy" value= {{ i.d_o_b}} required="true">
                                    </div>
                                    <div class="col-md-3">
                                             
                                            <div class="formlabel text-left"> Gender : </div>
                                            {% if i.gender == 'Male' %}
                                                <select class="form-control" id="dGender" name="gender" placeholder="Gender" required="true">
                                                    <option selected> Male </option>
                                                    <option> Female </option>
                                                </select>
                                            {% else %}
                                                <select class="form-control" id="dGender" name="gender" placeholder="Gender" required="true">
                                                    <option> Male </option>
                                                    <option selected> Female </option>
                                                </select>   
                                            {% endif %}
                                            
            
                                    </div>

                                    <div class="col-md-4">
                                        <div class="formlabel text-left">Mobile No :</div>
                                        <input type="text" class="form-control" id="dMobileNo" name="mobile_no" placeholder="Mobile No" value= {{ i.mobile_no}} required="true">
                                    </div>
                                </div>

                                <div class="form-row m-3">

                                    <div class="col-md-4">
                                        <div class="formlabel text-left">Department :</div>
                                        <input readonly type="text" class="form-control" id="dDepartment" name="depart_ment" value= {{ i.depart_ment}} >
                                    </div>
                                    <div class="col-md-4">
                                        <div class="formlabel text-left">E-mail :</div>
                                        <input readonly type="text" class="form-control" id="dEmail" name="e_mail" placeholder="E-mail" value= {{ i.e_mail}} required="true">
                                    </div>
                            
                                </div>

                                <div clas="form-row m-3">
                                    <div class="col-md-4">
                                        <div class="formlabel text-left"> Password :</div>
                                        <input type="password" class="form-control" id="dPass" name="pass_word" placeholder="Password" value= {{ i.pass_word}} required="true">
                                    </div>

                                </div>
                                
                                <div class="text-right mt-4 ">
                                        <button type="submit" id="update_button" class="btn btn-primary" > &nbsp Update &nbsp</button>                                 
                                </div>

                            {% endfor %}
                            </form>
                        </div>
                    </div>


                    <div id="VPG" class="tab-pane fade in">
                        <div class="container-fluid px-lg-4">
                            <div class="row">
                                <div class="col-md-12 mt-lg-4 mt-4">
                                    <div class="d-sm-flex align-items-center justify-content-between mb-4">
                                        <h1 class="h3 mb-0 text-gray-800"> Voice Prescription Generator</h1>
                                        
                                    </div>
                                    <div class="container-sm border pt-5">
        <div class="text-center ">
            <h3>Patient Details</h3>
            <div id="snackbar">Speak Now..</div>
        </div>
        <form action="pass" method="post" >
            {% csrf_token %}
            <!-- 2 column grid layout with text inputs for the first and last names -->
            <div class="row mb-4 pt-5">
            <div class="col">
                <div class="form-outline">
                    <div class="input-group mb-3">
                        <div class="input-group-prepend">
                            <button type="button" class="btn btn-success btn-form float-right" ><i class="fa fa-microphone" onclick="runSpeechRecognition('f_name');" style="font-size:20px"></i></button>
                        </div>
                        <input type="text" class="form-control" name="first_name" id="f_name" list="f_name_l" placeholder="First Name" autocomplete="off" >
                        <datalist id="f_name_l" ></datalist>
                    </div>
                </div>
            </div>
            <div class="col">
                <div class="form-outline">
                    <div class="input-group mb-3">
                        <div class="input-group-prepend">
                            <button type="button" class="btn btn-success btn-form float-right" ><i class="fa fa-microphone" onclick="runSpeechRecognition('l_name');" style="font-size:20px"></i></button>
                        </div>
                        <input type="text" class="form-control" name="last_name" id="l_name" list="l_name_l" placeholder="Last Name" id="usr"  autocomplete="off">
                        <datalist id="l_name_l" ></datalist>
                    </div>
                </div>
            </div>
            </div>
        
            <!-- Email input -->
            <div class="form-outline mb-4">
            <input type="email" id="form3Example3" class="form-control" />
            <label class="form-label" >Email address</label>
            </div>

            <div class="row mb-4 ">
                <div class="col">
                <div class="form-outline">
                    <div class="input-group mb-3">
                        <div class="input-group-prepend">
                            <button type="button" class="btn btn-success btn-form float-right" ><i class="fa fa-microphone" onclick="runSpeechRecognition('gender');" style="font-size:20px"></i></button>
                        </div>
                        <input type="text" class="form-control" name="gender" list="gender_l" placeholder="Gender of Patient" id="gender"  autocomplete="off">
                        <datalist id="gender_l">
                            <option value="Male">
                            <option value="Female">  
                          </datalist>
                        </div>
                </div>
                </div>
            </div>
        
            <!-- Password input -->
            
        
            <!-- Checkbox -->
            
        
            <!-- Submit button -->
            <button type="submit" class="btn btn-primary btn-block mb-4">Prescriptor--></button>
        
            <!-- Register buttons -->
            
        </form>
        
    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div id="appointment" class="tab-pane fade in">
                        <div class="container-fluid px-lg-4">
                            <div class="row">
                                <div class="col-md-12 mt-lg-4 mt-4">
                                    <div class="d-sm-flex align-items-center justify-content-between mb-4">
                                        <h1 class="h3 mb-0 text-gray-800"> Appointment</h1>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="ml-5" style="width:85%;">
                                    <div class="form-row toolbar form-group">
                                        <div class="col-md-11">
                                        </div>
                                        <div class="col-md-1 ">
                                            <button class="btn btn-block btn-secondary" id="update_btn_doc">Edit</button>
                                            <button class="btn btn-block btn-success" id="save_all_btn_doc" style="display:none;margin-top:0px">Save</button>
                                        </div>
                                    </div>
                            
                            <table class="apttable table table-bordered" style="background-color:white; max-width:100%;">
                                <thead>
                                <tr>
                                    <th>Apt No.</th>
                                    <th>Patient Name</th>
                                    <th>Gender</th>
                                    <th>Age</th>
                                    <th>Phone No.</th>
                                    <th>Appointment Date - Time</th>
                                    <th>Booking Date - Time</th>
                                    <th class="text-center">Status</th>
                                    <th>Comment</th>
                                </tr>
                                </thead>
                                <tbody>
                                    {% for app in appinfo %}
                                        <tr>
                                            <td class='text-center'>{{app.apt_id}}</td>
                                            <td>{{app.pat_name}}</td>
                                            <td>{{app.gender}}</td>
                                            <td>{{app.age}}</td>
                                            <td>{{app.mobile_no}}</td>
                                            <td>{{app.apt_date}} - {{app.apt_time}}</td>
                                            <td>{{app.book_date}} - {{app.book_time}}</td>
                                            {% if app.status == 'Canceled by Patient' %}
                                            <td class="text-center" data-type="status" colspan='2'>{{app.status}}</td>
                                            {% else %}
                                            <td class="editable text-center" data-type="status" >{{app.status}}</td>
                                            <td class="editable" data-type="remark">{{app.remark}}</td>
                                            {% endif %}
                                        </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                            
                        </div>


                    </div>
                    




    
                </div>




            </div>
        </div>
    </div>

    
    


    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.5.1.js" integrity="sha256-QWo7LDvxbWT2tbbQ97B53yJnYU3WhH/C8ycbRAkjPDc=" crossorigin="anonymous"></script>

    <script>

    $('#bar').click(function(){
        $(this).toggleClass('open');
        $('#page-content-wrapper ,#sidebar-wrapper').toggleClass('toggled' );

    });

    $(function(){
        $('navbar-nav.nav-link').on('click',function(){
            $(this).parent().find('li.active').removeCLass('active');
            $(this).addClass('active');
        })
    });

    </script>


    <script>

     $("#update_btn_doc").click(function(){
            $("#update_btn_doc").hide();
            $("#save_all_btn_doc").show();

            $(".editable").each(function(){
                var types=$(this).data('type');
                var value=$(this).text();
                if(types =='status')
                {
                    var html_data="<select name='"+types+"'  class='input_"+types+" input_data' >";
                    if(value=="Booked"){
                        html_data+="<option selected>Booked</option><option>Confirmed</option><option>Completed</option><option>Canceled</option>";
                    }
                    else if(value =="Confirmed"){
                        html_data+="<option>Booked</option><option selected>Confirmed</option><option>Completed</option><option>Canceled</option>";
                    }
                    else if(value == "Completed")
                    {
                         html_data+="<option>Booked</option><option>Confirmed</option><option selected>Completed</option><option>Canceled</option>";
                  
                    }
                    else{
                         html_data+="<option>Booked</option><option>Confirmed</option><option>Completed</option><option selected>Canceled</option>";
                  
                    }
                    html_data+="</select>";
                    $(this).html(html_data);
                }
                else{
                    var html_data="<input type='text' name='"+types+"' size='"+8+"' class='input_"+types+" input_data' value='"+value+"'>";
                    $(this).html(html_data);
                }
            });
        });
        $("#save_all_btn_doc").click(function(){
            $("#save_all_btn_doc").attr("disabled","disabled");

            var json_data=[];

            $(".input_data").each(function(){
                    var value=$(this).val();
                    var parent_html=$(this).parent();
                    parent_html.html(value);
                    $(this).remove();
            });

            $(".apttable tbody tr").each(function(){
                var apt_id=$(this).children().eq(0).text()
                var status=$(this).children().eq(7).text()
                var remark=$(this).children().eq(8).text()
                var single_data={"apt_id":apt_id, "status":status, "remark":remark};
                json_data.push(single_data);
            });

            var string_data=JSON.stringify(json_data)

            $.ajax({
                url:'{% url "updateaptbydoctor" %}',
                type:'POST',
                data:{data:string_data}
            })
                
            .always(function(){
                $("#save_all_btn_doc").removeAttr("disabled");
                $("#save_all_btn_doc").text("Save");
                $("#update_btn_doc").show();
                $("#save_all_btn_doc").hide();
            })

        });


    </script>




    </body>
</html>

